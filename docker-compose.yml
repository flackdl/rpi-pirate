version: '2'

services:
 transmission:
  image: flackdl/rpi-transmission-openvpn
  cap_add:
    - NET_ADMIN
  devices:
    - "/dev/net/tun"
  restart: always
  ports:
    - "9091:9091"
    - "8888:8888"
  dns:
    - 8.8.8.8
    - 8.8.4.4
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - ${TORRENTS_DIR}:/data
  env_file:
    - .env
  environment:
    - OPENVPN_OPTS=--inactive 3600 --ping 10 --ping-exit 60
    - LOCAL_NETWORK=192.168.1.0/24

 proxy:
  image: flackdl/rpi-transmission-openvpn-proxy
  restart: always
  depends_on:
    - transmission
  links:
    - transmission
  ports:
    - "8080:8080"
  volumes:
    - /etc/localtime:/etc/localtime:ro
  env_file:
    - .env

 jackett:
  image: lsioarmhf/jackett
  restart: always
  ports:
    - "9117:9117"
  volumes:
    - ${TORRENTS_DIR}/jackett:/config 

 samba:
  image: flackdl/samba-armhf
  restart: always
  ports:
    - "137:137/udp"
    - "138:138/udp"
    - "139:139"
    - "445:445"
  env_file:
    - .env
  command: -n -u "${SMB_USER};${SMB_PASS}" -s "torrents;/torrents" -g "min protocol = CORE" -g "netbios name = rpi" -g "workgroup = blackhole"
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - ${TORRENTS_DIR}:/torrents:ro
  # routinely update dynamic dns (since this image has curl already installed)
  labels:
    deck-chores.dyn-dns.command: curl -s "$DNS_UPDATE_URL"
    deck-chores.dyn-dns.interval: "2:00:00"

 ssh-to-docker-host:
   build: https://github.com/flackdl/rpi-docker-autossh.git
   restart: always
   env_file:
    - .env
   volumes:
    - $PWD/id_rsa:/id_rsa
   dns:
    - 8.8.8.8
    - 4.2.2.4

 deck-chores:
   image: funkyfuture/deck-chores:0.3-armv7l
   restart: unless-stopped
   volumes:
     - /var/run/docker.sock:/var/run/docker.sock
   logging:
     options:
       max-size: 10m       
